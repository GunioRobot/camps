#!/usr/local/bin/perl

use strict;
use warnings;
use lib '/home/camp/lib';
use Cwd;
use Camp::Master;

my $camp;

if (@ARGV and $ARGV[0] =~ /\A\d+\z/) {
    # first command-line argument can be camp number
    $camp = shift;
}

unless ($camp) {
    # if not specified, get current camp # from current working directory
    my $dir = getcwd();
    die "current working directory doesn't exist!\n" unless $dir;
    $dir =~ m{/camp(\d+)} and $camp = $1;
}

unless (defined($camp)) {
    die "Please specify a camp #\n";
}

initialize(
    camp => $camp,
);

my $conf = config_hash();
my $port = $conf->{db_port};

$ENV{PGUSER} ||= $conf->{db_default_user};
$ENV{PGDATABASE} ||= $conf->{db_default_database};

exec '/usr/bin/psql', '-p', $port, @ARGV;


=pod

=head1 NAME

psql_camp - invoke the psql client for a camp PostgreSQL instance

=head1 VERSION

3.00

=head1 AUTHOR

Jon Jensen E<lt>ethan@endpoint.comE<gt> and other contributors

=head1 LICENSE AND COPYRIGHT

Copyright (C) 2006-2009 End Point Corporation, http://www.endpoint.com/

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see: http://www.gnu.org/licenses/

=cut
